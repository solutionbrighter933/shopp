"use strict";(globalThis.webpackChunk_shopee_voucher_rw=globalThis.webpackChunk_shopee_voucher_rw||[]).push([[675],{80:(e,r,t)=>{t.d(r,{Sw:()=>d});var a=t(1594),_=t(9066),n=t(574),E=t(2455),o=t(3924);let u=Object.freeze({IOS_WEB:1,IOS_APP:2,ANDROID_WEB:3,ANDROID_APP:4,PC_MALL:5,IOS_LITE:6,ANDROID_LITE:7,OTHERS:128}),s=(0,o.Fr)()?(0,o.m0)()?u.ANDROID_WEB:(0,o.un)()?u.IOS_WEB:u.OTHERS:u.PC_MALL;var l=t(2552),i=t(7013);let{post:c}=n.FetchUtils,O=null;async function R(e){O||(O=l.ABTest.init({country:(0,i.JK)(),bizName:"marketplace",isWsa:!0}));try{let r=await O.fetchInc([e.scene_key],(0,i.JK)(),e.filter_data,async(e,r)=>await c(e,r));if(!(r?.data?.length>0))return{...r,data:null};{let e={},t={};for(let a of r.data){for(let r of a.experiments)e[r.exp_name]=r;for(let e of a.feature_map||[])t[e.feature_key]=e.feature_value}return{...r,data:{experiments:e,features:t}}}}catch(e){return{error:e,error_msg:e?.error_msg??e?.message,data:null}}}let C=async e=>{let[,,r,t]=e.queryKey;try{let e=function(e){let r=[...e||[]];if(null==r.find(e=>"platform"===e.name)){let e=p[s]||32;r.push({name:"platform",value_type:"INT",value:String(e)})}return r}(t),{error:a,data:_}=await R({scene_key:r,filter_data:e});if(a||!_)throw Error("failed to load scene");return{experiments:{..._.experiments||{}},features:{..._.features||{}}}}catch{return null}};function S(e,r){return e.name>r.name?1:e.name<r.name?-1:e.value_type>r.value_type?1:e.value_type<r.value_type?-1:e.value>r.value?1:e.value<r.value?-1:0}let p={[u.ANDROID_APP]:1,[u.IOS_APP]:2,[u.ANDROID_WEB]:4,[u.IOS_WEB]:8,[u.PC_MALL]:16,[u.ANDROID_LITE]:32,[u.IOS_LITE]:32,[u.OTHERS]:32};function d(e,r,t,o){let{experiments:u,progress:s}=function(e,r,t){let o=(0,a.useMemo)(()=>(function(e){if(e)return e.slice().sort(S)})(r),[r]),u=!!(0,a.useContext)(n.State.HostReactQueryContext);try{let{data:r,isLoading:a}=(0,E.I)(function(e,r,t=!1){return{queryKey:["platform","abtest",e,r],queryFn:C,context:n.State.HostReactQueryContext,suspense:t}}(e,o,t));if(a)return{progress:_.Gd.REQ};if(!r)return{progress:_.Gd.ERR};let{experiments:u,features:s}=r;return{experiments:u,features:s,progress:_.Gd.OK}}catch(e){if(!u)return{progress:_.Gd.INIT};throw e}}(e,t,o);return[u?.[r]?u[r]:void 0,s]}},3501:(e,r,t)=>{t.d(r,{$k:()=>l,$m:()=>s,S_:()=>i,Ub:()=>O,Us:()=>_,VZ:()=>c,YZ:()=>u,bZ:()=>n,hq:()=>E,zo:()=>o});var a=t(7548);let _=(0,a.b)("FETCH_SHOP_VOUCHERS"),n=(0,a.b)("BATCH_FETCH_SHOP_VOUCHERS"),E=(0,a.b)("GET_VOUCHER_WALLET_VOUCHER_DETAIL"),o=(0,a.b)("FETCH_RECOMMEND_SHOP_VOUCHER"),u=(0,a.b)("SAVE_SHOP_VOUCHER"),s=(0,a.b)("SAVE_SHOP_VOUCHER_BY_VOUCHER_CODE"),l="ADD_RECOMMEND_SHOP_VOUCHER",i="REMOVE_RECOMMEND_SHOP_VOUCHER",c="UPDATE_RECOMMEND_SHOP_VOUCHER",O="SET_RECOMMEND_SHOP_VOUCHER_CLAIMED"},9615:(e,r,t)=>{e.exports=t.microfeI(0)},9675:(e,r,t)=>{t.d(r,{tF:()=>f,G0:()=>p,E0:()=>S});var a=t(2796),_=t(1594),n=t(80),E=t(2530),o=t(574),u=t(9288),s=t(9615),l=t(6983),i=t(9040),c=t(4514),O=t(9716),R=t(7013),C=t(9762);function S(){return(0,_.useMemo)(()=>({env:(0,R._$)(),language:(0,R.mf)(),locale:(0,R.JK)(),platform:"rw",featureToggles:{VOUCHER_DRAWER_TNC_OK_CTA:(0,O.isFeatureEnabled)(c.Hov),VOUCHER_SHOW_FREE_SHIPPING_MIN_SPEND_IN_VOUCHER_WALLET:(0,O.isFeatureEnabled)(c.EDf),VOUCHER_SHOW_FREE_SHIPPING_MIN_SPEND_IN_VOUCHER_SELECTION_PAGE:(0,O.isFeatureEnabled)(c.nxe),SELLER_VOUCHER_DISPLAY_LIMITED_RIBBON:(0,O.isFeatureEnabled)(c.UHC),VOUCHER_TWO_LABEL_ROWS:(0,O.isFeatureEnabled)(c.x73),FSV_SHOW_LIMITED_REDEMPTION_FLAG:(0,O.isFeatureEnabled)(c.MoL),FSV_SHOW_PRODUCT_SCOPE:(0,O.isFeatureEnabled)(c.HiQ),VOUCHER_LATAM_UI_REVAMP:(0,O.isFeatureEnabled)(c.GYv),VOUCHER_SEA_TW_UI_REVAMP:(0,O.isFeatureEnabled)(c.ype),VOUCHER_SEA_TW_REVAMP_PROGRESS_BAR:(0,O.isFeatureEnabled)(c.vOD)}}),[])}function p({voucher:e,onClaim:r,onServerError:t,onClaimSuccess:a,onClaimFailure:n}){let E=(0,i.useDispatch)();return{claim:(0,_.useCallback)(()=>{E((0,C.uJ)({promotionid:e.promotionid,voucher_code:e.voucher_code||"",shopid:e.shop_id})).then(({error:_,response:E})=>{let o,u;o=l.cO.CLAIM_ERROR_OK,u=null,_||!E||E.error||!E.data?o=l.cO.CLAIM_ERROR_UNKNOWN:(o=E.data.invalid_message_code||o,u=E.data.error_config),r?.(e,o,u),function(){if(!E||_)return t?.();let{data:r}=E;if(!r)return t?.();let{invalid_message_code:o}=r;o?n?.(e,o):a?.(e)}()})},[E,r,n,a,t,e])}}let{t:d}=o.I18n,f=(0,_.memo)(function({children:e}){let{env:r,language:t,locale:_,platform:o,featureToggles:i}=S(),[c]=(0,n.Sw)("FSV_VLP_VOUCHER_TOGGLE","FSV_VLP_VOUCHER_TOGGLE_WEB"),[O]=(0,n.Sw)(l.jc,l._I),[R]=(0,n.Sw)(l._F.SCENE_KEY,l._F.EXPERIMENT_NAME),C={fsvVLP:c?.parameter,fsvVLP2:O?.parameter,limitedUsage:R?.parameter},{fetchAccountInfo:p}=(0,E.T)();return(0,a.jsx)(s.VoucherCardEnvProvider,{env:r,language:t,locale:_,t:d,platform:o,featureToggles:i,useTrackClick:u.useTrackClick,useTrackImpression:u.useTrackImpression,abTest:C,fetchAccountInfo:p,children:e})})},9762:(e,r,t)=>{t.d(r,{K:()=>s,OL:()=>u,Wg:()=>E,b5:()=>l,gX:()=>c,mK:()=>i,tk:()=>n,uJ:()=>o});var a=t(2577),_=t(3501);let n=({promotionid:e,voucher_code:r,signature:t="",need_basic_info:n=!1,need_user_voucher_status:E=!1,source:o="0",addition:u=[]})=>async s=>{s({type:_.hq.REQUESTED,promotionid:e,voucher_code:r,signature:t||"",need_basic_info:n,need_user_voucher_status:E,addition:u});let l=await a.tk(e,r,t||"",{need_basic_info:n,need_user_voucher_status:E,source:o,addition:u}),{response:i}=l,c=l.error,O=l.error_msg,R=l.status;return"string"==typeof l.error&&"number"==typeof R&&(O=l.error,c=R),s(i&&!i.error&&i.data?{type:_.hq.SUCCESS,data:i.data,promotionid:e,voucher_code:r,signature:t,need_basic_info:n,need_user_voucher_status:E,addition:u}:{type:_.hq.FAILED,error:c,error_msg:O,promotionid:e,voucher_code:r,signature:t,need_basic_info:n,need_user_voucher_status:E,addition:u}),l},E=({orders:e,group_buy_info:r,slash_price_info:t,spm_channel_id:n,legacy_spm_channel_id:E,check_voucher_payment_criteria:o,card_bin_number:u,shopId:s,shop_ids:l,isCheckout:i,selected_payment_channel_data:c,sorting_flag:O,priority_promotion_ids:R,has_redeem_coins:C,platform_vouchers:S,move_up_addon_voucher:p,cursor:d})=>async f=>{d||f({type:_.zo.REQUESTED,orders:e,groupBuyInfo:r,slashPriceInfo:t,spmChannelId:n,legacySpmChannelId:E,checkVoucherPaymentCriteria:o,cardBinNumber:u,shopId:s,shop_ids:l,isCheckout:i,selectedPaymentChannelData:c,sorting_flag:O,priority_promotion_ids:R});let{response:I}=await a.Wg({orders:e,shopid:s,shop_ids:l,group_buy_info:r,slash_price_info:t,spm_channel_id:n,legacy_spm_channel_id:E,check_voucher_payment_criteria:o,card_bin_number:u,...O?{sorting_flag:O}:{},priority_promotion_ids:R||[],...c?{selected_payment_channel_data:c}:{},has_redeem_coins:C,platform_vouchers:S,move_up_addon_voucher:p,caller_source:i?a.pq.VOUCHER_OPC_DRAWER:a.pq.VOUCHER_CART_DRAWER,cursor:d});return f(I&&!I.error&&(I.data||I.shop_voucher_lists)?{type:_.zo.SUCCESS,shopId:s,shop_ids:l,isCheckout:i,data:I.data,shop_voucher_lists:I.shop_voucher_lists,next_cursor:I.next_cursor}:{type:_.zo.FAILED,shopId:s,shop_ids:l,isCheckout:i,error:I?.error,error_msg:I?.error_msg}),{response:I}};function o({promotionid:e,voucher_code:r,shopid:t}){return async n=>{n({type:_.YZ.REQUESTED,promotionid:e,voucher_code:r,shopid:t});let E=await a.uJ({promotionid:e,voucher_code:r,shopid:t}),{response:o}=E;return n(!o||o.error?{type:_.YZ.FAILED,error:o&&o.error,error_msg:o&&o.error_msg,promotionid:e,voucher_code:r,shopid:t}:{type:_.YZ.SUCCESS,...o.data,promotionid:e,voucher_code:r,shopid:t}),E}}function u({voucher_code:e,shop_ids:r,shop_orders:t}){return async n=>{n({type:_.$m.REQUESTED,voucher_code:e,shop_ids:r,shop_orders:t});let E=await a.OL({voucher_code:e,shop_ids:r,shop_orders:t}),{response:o}=E;return n(!o||o.error||o.data&&(o.data.invalid_message_code||o.data.error_config)?{type:_.$m.FAILED,error:o&&o.error,error_msg:o&&o.error_msg,...o?o.data:{},voucher_code:e,shop_ids:r,shop_orders:t}:{type:_.$m.SUCCESS,...o.data,voucher_code:e,shop_ids:r,shop_orders:t}),E}}let s=e=>({type:_.$k,voucher:e}),l=e=>({type:_.S_,voucher:e}),i=e=>({type:_.VZ,voucher:e}),c=e=>({type:_.Ub,voucher:e})}}]);
//# sourceMappingURL=https://sourcemap.webfe.shopeemobile.com/mobilemall-voucher/_/675.07933d663f85f5f842f1.2023.js.map