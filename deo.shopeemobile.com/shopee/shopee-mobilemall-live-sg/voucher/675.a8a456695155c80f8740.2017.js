"use strict";(self.webpackChunk_shopee_voucher_rw=self.webpackChunk_shopee_voucher_rw||[]).push([[675],{80:(e,r,o)=>{o.d(r,{Sw:()=>S});var n,t=o(1594),_=o(9066),a=o(574),s=o(2455),u=o(3924),i=Object.freeze({IOS_WEB:1,IOS_APP:2,ANDROID_WEB:3,ANDROID_APP:4,PC_MALL:5,IOS_LITE:6,ANDROID_LITE:7,OTHERS:128}),c=(0,u.Fr)()?(0,u.m0)()?i.ANDROID_WEB:(0,u.un)()?i.IOS_WEB:i.OTHERS:i.PC_MALL,d=o(6048),l=o(9469),E=o(9170),p=o(3370),h=o(2552),v=o(7013),f=a.FetchUtils.post,m=null,O=function(e){return(0,d._)(function(){var r,o,n,t,_,a,s;return(0,E.YH)(this,function(u){switch(u.label){case 0:o=(r=e.queryKey)[2],n=r[3],u.label=1;case 1:var i;return u.trys.push([1,3,,4]),t=function(e){var r=[].concat(e||[]);if(null==r.find(function(e){return"platform"===e.name})){var o=R[c]||32;r.push({name:"platform",value_type:"INT",value:String(o)})}return r}(n),[4,(i={scene_key:o,filter_data:t},(0,d._)(function(){var e,r,o,n,t,_,a,s,u,c,O,C,R,S,I;return(0,E.YH)(this,function(H){switch(H.label){case 0:m||(m=h.ABTest.init({country:(0,v.JK)(),bizName:"marketplace",isWsa:!0})),H.label=1;case 1:return H.trys.push([1,3,,4]),[4,m.fetchInc([i.scene_key],(0,v.JK)(),i.filter_data,function(e,r){return(0,d._)(function(){return(0,E.YH)(this,function(o){switch(o.label){case 0:return[4,f(e,r)];case 1:return[2,o.sent()]}})})()})];case 2:if(!((null==(r=H.sent())||null==(e=r.data)?void 0:e.length)>0))return[2,(0,l._)({},r,{data:null})];for(o={},n={},t=(0,p._)(r.data);!(_=t()).done;){for(a=_.value,s=(0,p._)(a.experiments);!(u=s()).done;)o[(c=u.value).exp_name]=c;for(O=(0,p._)(a.feature_map||[]);!(C=O()).done;)n[(R=C.value).feature_key]=R.feature_value}return[2,(0,l._)({},r,{data:{experiments:o,features:n}})];case 3:return[2,{error:S=H.sent(),error_msg:null!=(I=null==S?void 0:S.error_msg)?I:null==S?void 0:S.message,data:null}];case 4:return[2]}})})())];case 2:if(a=(_=u.sent()).error,s=_.data,a||!s)throw Error("failed to load scene");return[2,{experiments:(0,l._)({},s.experiments||{}),features:(0,l._)({},s.features||{})}];case 3:return u.sent(),[2,null];case 4:return[2]}})})()};function C(e,r){return e.name>r.name?1:e.name<r.name?-1:e.value_type>r.value_type?1:e.value_type<r.value_type?-1:e.value>r.value?1:e.value<r.value?-1:0}var R=((n={})[i.ANDROID_APP]=1,n[i.IOS_APP]=2,n[i.ANDROID_WEB]=4,n[i.IOS_WEB]=8,n[i.PC_MALL]=16,n[i.ANDROID_LITE]=32,n[i.IOS_LITE]=32,n[i.OTHERS]=32,n);function S(e,r,o,n){var u=function(e,r,o){var n=(0,t.useMemo)(function(){return r?r.slice().sort(C):void 0},[r]),u=!!(0,t.useContext)(a.State.HostReactQueryContext);try{var i,c,d,l=(0,s.I)((i=e,c=n,d=o,void 0===d&&(d=!1),{queryKey:["platform","abtest",i,c],queryFn:O,context:a.State.HostReactQueryContext,suspense:d})),E=l.data;if(l.isLoading)return{progress:_.Gd.REQ};if(!E)return{progress:_.Gd.ERR};var p=E.experiments,h=E.features;return{experiments:p,features:h,progress:_.Gd.OK}}catch(e){if(!u)return{progress:_.Gd.INIT};throw e}}(e,o,n),i=u.experiments,c=u.progress;return[(null==i?void 0:i[r])?i[r]:void 0,c]}},3501:(e,r,o)=>{o.d(r,{$k:()=>c,$m:()=>i,S_:()=>d,Ub:()=>E,Us:()=>t,VZ:()=>l,YZ:()=>u,bZ:()=>_,hq:()=>a,zo:()=>s});var n=o(7548),t=(0,n.b)("FETCH_SHOP_VOUCHERS"),_=(0,n.b)("BATCH_FETCH_SHOP_VOUCHERS"),a=(0,n.b)("GET_VOUCHER_WALLET_VOUCHER_DETAIL"),s=(0,n.b)("FETCH_RECOMMEND_SHOP_VOUCHER"),u=(0,n.b)("SAVE_SHOP_VOUCHER"),i=(0,n.b)("SAVE_SHOP_VOUCHER_BY_VOUCHER_CODE"),c="ADD_RECOMMEND_SHOP_VOUCHER",d="REMOVE_RECOMMEND_SHOP_VOUCHER",l="UPDATE_RECOMMEND_SHOP_VOUCHER",E="SET_RECOMMEND_SHOP_VOUCHER_CLAIMED"},9615:(e,r,o)=>{e.exports=o.microfeI(0)},9675:(e,r,o)=>{o.d(r,{tF:()=>O,G0:()=>f,E0:()=>v});var n=o(2796),t=o(1594),_=o(80),a=o(2530),s=o(574),u=o(9288),i=o(9615),c=o(6983),d=o(9040),l=o(4514),E=o(9716),p=o(7013),h=o(9762);function v(){return(0,t.useMemo)(function(){return{env:(0,p._$)(),language:(0,p.mf)(),locale:(0,p.JK)(),platform:"rw",featureToggles:{VOUCHER_DRAWER_TNC_OK_CTA:(0,E.isFeatureEnabled)(l.Hov),VOUCHER_SHOW_FREE_SHIPPING_MIN_SPEND_IN_VOUCHER_WALLET:(0,E.isFeatureEnabled)(l.EDf),VOUCHER_SHOW_FREE_SHIPPING_MIN_SPEND_IN_VOUCHER_SELECTION_PAGE:(0,E.isFeatureEnabled)(l.nxe),SELLER_VOUCHER_DISPLAY_LIMITED_RIBBON:(0,E.isFeatureEnabled)(l.UHC),VOUCHER_TWO_LABEL_ROWS:(0,E.isFeatureEnabled)(l.x73),FSV_SHOW_LIMITED_REDEMPTION_FLAG:(0,E.isFeatureEnabled)(l.MoL),FSV_SHOW_PRODUCT_SCOPE:(0,E.isFeatureEnabled)(l.HiQ),VOUCHER_LATAM_UI_REVAMP:(0,E.isFeatureEnabled)(l.GYv),VOUCHER_SEA_TW_UI_REVAMP:(0,E.isFeatureEnabled)(l.ype),VOUCHER_SEA_TW_REVAMP_PROGRESS_BAR:(0,E.isFeatureEnabled)(l.vOD)}}},[])}function f(e){var r=e.voucher,o=e.onClaim,n=e.onServerError,_=e.onClaimSuccess,a=e.onClaimFailure,s=(0,d.useDispatch)();return{claim:(0,t.useCallback)(function(){s((0,h.uJ)({promotionid:r.promotionid,voucher_code:r.voucher_code||"",shopid:r.shop_id})).then(function(e){var t,s,u=e.error,i=e.response;t=c.cO.CLAIM_ERROR_OK,s=null,u||!i||i.error||!i.data?t=c.cO.CLAIM_ERROR_UNKNOWN:(t=i.data.invalid_message_code||t,s=i.data.error_config),null==o||o(r,t,s),function(){if(!i||u){null==n||n();return}var e=i.data;if(!e){null==n||n();return}var o=e.invalid_message_code;if(!o){null==_||_(r);return}null==a||a(r,o)}()})},[s,o,a,_,n,r])}}var m=s.I18n.t,O=(0,t.memo)(function(e){var r=e.children,o=v(),t=o.env,s=o.language,d=o.locale,l=o.platform,E=o.featureToggles,p=(0,_.Sw)("FSV_VLP_VOUCHER_TOGGLE","FSV_VLP_VOUCHER_TOGGLE_WEB")[0],h=(0,_.Sw)(c.jc,c._I)[0],f=(0,_.Sw)(c._F.SCENE_KEY,c._F.EXPERIMENT_NAME)[0],O={fsvVLP:null==p?void 0:p.parameter,fsvVLP2:null==h?void 0:h.parameter,limitedUsage:null==f?void 0:f.parameter},C=(0,a.T)().fetchAccountInfo;return(0,n.jsx)(i.VoucherCardEnvProvider,{env:t,language:s,locale:d,t:m,platform:l,featureToggles:E,useTrackClick:u.useTrackClick,useTrackImpression:u.useTrackImpression,abTest:O,fetchAccountInfo:C,children:r})})},9762:(e,r,o)=>{o.d(r,{K:()=>l,OL:()=>d,Wg:()=>i,b5:()=>E,gX:()=>h,mK:()=>p,tk:()=>u,uJ:()=>c});var n=o(6048),t=o(9469),_=o(9170),a=o(2577),s=o(3501),u=function(e){var r=e.promotionid,o=e.voucher_code,t=e.signature,u=void 0===t?"":t,i=e.need_basic_info,c=void 0!==i&&i,d=e.need_user_voucher_status,l=void 0!==d&&d,E=e.source,p=void 0===E?"0":E,h=e.addition,v=void 0===h?[]:h;return function(e){return(0,n._)(function(){var n,t,i,d,E;return(0,_.YH)(this,function(_){switch(_.label){case 0:return e({type:s.hq.REQUESTED,promotionid:r,voucher_code:o,signature:u||"",need_basic_info:c,need_user_voucher_status:l,addition:v}),[4,a.tk(r,o,u||"",{need_basic_info:c,need_user_voucher_status:l,source:p,addition:v})];case 1:return t=(n=_.sent()).response,i=n.error,d=n.error_msg,E=n.status,"string"==typeof n.error&&"number"==typeof E&&(d=n.error,i=E),t&&!t.error&&t.data?e({type:s.hq.SUCCESS,data:t.data,promotionid:r,voucher_code:o,signature:u,need_basic_info:c,need_user_voucher_status:l,addition:v}):e({type:s.hq.FAILED,error:i,error_msg:d,promotionid:r,voucher_code:o,signature:u,need_basic_info:c,need_user_voucher_status:l,addition:v}),[2,n]}})})()}},i=function(e){var r=e.orders,o=e.group_buy_info,u=e.slash_price_info,i=e.spm_channel_id,c=e.legacy_spm_channel_id,d=e.check_voucher_payment_criteria,l=e.card_bin_number,E=e.shopId,p=e.shop_ids,h=e.isCheckout,v=e.selected_payment_channel_data,f=e.sorting_flag,m=e.priority_promotion_ids,O=e.has_redeem_coins,C=e.platform_vouchers,R=e.move_up_addon_voucher,S=e.cursor;return function(e){return(0,n._)(function(){var n;return(0,_.YH)(this,function(_){switch(_.label){case 0:return S||e({type:s.zo.REQUESTED,orders:r,groupBuyInfo:o,slashPriceInfo:u,spmChannelId:i,legacySpmChannelId:c,checkVoucherPaymentCriteria:d,cardBinNumber:l,shopId:E,shop_ids:p,isCheckout:h,selectedPaymentChannelData:v,sorting_flag:f,priority_promotion_ids:m}),[4,a.Wg((0,t._)({orders:r,shopid:E,shop_ids:p,group_buy_info:o,slash_price_info:u,spm_channel_id:i,legacy_spm_channel_id:c,check_voucher_payment_criteria:d,card_bin_number:l},f?{sorting_flag:f}:{},{priority_promotion_ids:m||[]},v?{selected_payment_channel_data:v}:{},{has_redeem_coins:O,platform_vouchers:C,move_up_addon_voucher:R,caller_source:h?a.pq.VOUCHER_OPC_DRAWER:a.pq.VOUCHER_CART_DRAWER,cursor:S}))];case 1:return(n=_.sent().response)&&!n.error&&(n.data||n.shop_voucher_lists)?e({type:s.zo.SUCCESS,shopId:E,shop_ids:p,isCheckout:h,data:n.data,shop_voucher_lists:n.shop_voucher_lists,next_cursor:n.next_cursor}):e({type:s.zo.FAILED,shopId:E,shop_ids:p,isCheckout:h,error:null==n?void 0:n.error,error_msg:null==n?void 0:n.error_msg}),[2,{response:n}]}})})()}};function c(e){var r=e.promotionid,o=e.voucher_code,u=e.shopid;return function(e){return(0,n._)(function(){var n,i;return(0,_.YH)(this,function(_){switch(_.label){case 0:return e({type:s.YZ.REQUESTED,promotionid:r,voucher_code:o,shopid:u}),[4,a.uJ({promotionid:r,voucher_code:o,shopid:u})];case 1:return(i=(n=_.sent()).response)&&!i.error?e((0,t._)({type:s.YZ.SUCCESS},i.data,{promotionid:r,voucher_code:o,shopid:u})):e({type:s.YZ.FAILED,error:i&&i.error,error_msg:i&&i.error_msg,promotionid:r,voucher_code:o,shopid:u}),[2,n]}})})()}}function d(e){var r=e.voucher_code,o=e.shop_ids,u=e.shop_orders;return function(e){return(0,n._)(function(){var n,i;return(0,_.YH)(this,function(_){switch(_.label){case 0:return e({type:s.$m.REQUESTED,voucher_code:r,shop_ids:o,shop_orders:u}),[4,a.OL({voucher_code:r,shop_ids:o,shop_orders:u})];case 1:return!(i=(n=_.sent()).response)||i.error||i.data&&(i.data.invalid_message_code||i.data.error_config)?e((0,t._)({type:s.$m.FAILED,error:i&&i.error,error_msg:i&&i.error_msg},i?i.data:{},{voucher_code:r,shop_ids:o,shop_orders:u})):e((0,t._)({type:s.$m.SUCCESS},i.data,{voucher_code:r,shop_ids:o,shop_orders:u})),[2,n]}})})()}}var l=function(e){return{type:s.$k,voucher:e}},E=function(e){return{type:s.S_,voucher:e}},p=function(e){return{type:s.VZ,voucher:e}},h=function(e){return{type:s.Ub,voucher:e}}}}]);
//# sourceMappingURL=https://sourcemap.webfe.shopeemobile.com/mobilemall-voucher/_/675.a8a456695155c80f8740.2017.js.map